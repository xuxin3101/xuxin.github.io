<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Mybatis与spring的结合使用 | 我的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="宋熙卿,宋熙卿的博客">
  
  <meta name="description" content="我将采用讲解我们学校老师布置的大作业的方式，讲解其实现方式。题目要求：123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687">
<meta name="keywords" content="orm,spring,mybatis,事务">
<meta property="og:type" content="article">
<meta property="og:title" content="Mybatis与spring的结合使用">
<meta property="og:url" content="https://github.com/xuxin3101/xuxin.github.io/2019/05/08/Mybatis与spring的结合使用/index.html">
<meta property="og:site_name" content="我的博客">
<meta property="og:description" content="我将采用讲解我们学校老师布置的大作业的方式，讲解其实现方式。题目要求：123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687">
<meta property="og:locale" content="zh_cn">
<meta property="og:image" content="https://github.com/xuxin.github.io/images/pasted-7.png">
<meta property="og:updated_time" content="2019-07-30T10:37:11.612Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mybatis与spring的结合使用">
<meta name="twitter:description" content="我将采用讲解我们学校老师布置的大作业的方式，讲解其实现方式。题目要求：123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687">
<meta name="twitter:image" content="https://github.com/xuxin.github.io/images/pasted-7.png">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/xuxin.github.io/css/style.css">
  <script src="/xuxin.github.io/js/pace.min.js"></script>
  

  
  

</head>
</html>
<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/xuxin.github.io/" class="left">
                    <span class="site-title">宋熙卿的博客</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a href="/xuxin.github.io/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a href="/xuxin.github.io/archives">
                        <i class="fa fa-archive"></i>
                        <span>归档</span>
                    </a>
                    
                    <a href="/xuxin.github.io/about">
                        <i class="fa fa-user"></i>
                        <span>关于</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/xuxin.github.io/">
                    <img src="/xuxin.github.io/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        宋熙卿的博客
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        一个正在成长的前端菜鸟
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="MinHow" target="_blank" href="//blog.gamewan.top">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="//github.com/xuxin3101">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-Mybatis与spring的结合使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      Mybatis与spring的结合使用
    </h1>
    <div class="post-title-bar">
      <ul>
          
        <li>
          <i class="fa fa-calendar"></i>  2019-05-08
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <p>我将采用讲解我们学校老师布置的大作业的方式，讲解其实现方式。<br>题目要求：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">1、</span><br><span class="line">大作业要求使用MyBatis和Spring框架整合，添加事务管理机制, 使用Mapper接口方式的开发整合完成：</span><br><span class="line"></span><br><span class="line">（1）  创建一张订单t_orders表，一张商品表t_goods表二者N：N的关联关系。</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">-- Table structure for `t_goods`</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `t_goods`;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `t_goods` (</span><br><span class="line"></span><br><span class="line">  `id` int(11) NOT NULL auto_increment,</span><br><span class="line"></span><br><span class="line">  `goodname` varchar(20) NOT NULL default &apos;&apos;,</span><br><span class="line"></span><br><span class="line">  `price` float NOT NULL default &apos;0&apos;,</span><br><span class="line"></span><br><span class="line">  PRIMARY KEY  (`id`)</span><br><span class="line"></span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">-- Records of t_goods</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods` VALUES (&apos;1&apos;, &apos;nike shoes12-3&apos;, &apos;560&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods` VALUES (&apos;2&apos;, &apos;李宁15-1&apos;, &apos;146&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods` VALUES (&apos;3&apos;, &apos;外套&apos;, &apos;780&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods` VALUES (&apos;4&apos;, &apos;裤子&apos;, &apos;360&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods` VALUES (&apos;5&apos;, &apos;帽子&apos;, &apos;160&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods` VALUES (&apos;6&apos;, &apos;手表&apos;, &apos;30000&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">-- Table structure for `t_goods_orders`</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `t_goods_orders`;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `t_goods_orders` (</span><br><span class="line"></span><br><span class="line">  `id` int(11) NOT NULL auto_increment,</span><br><span class="line"></span><br><span class="line">  `good_id` int(11) NOT NULL default &apos;0&apos;,</span><br><span class="line"></span><br><span class="line">  `order_id` int(11) NOT NULL default &apos;0&apos;,</span><br><span class="line"></span><br><span class="line">  `number` int(11) NOT NULL default &apos;0&apos;,</span><br><span class="line"></span><br><span class="line">  PRIMARY KEY  (`id`),</span><br><span class="line"></span><br><span class="line">  KEY `fr1` (`good_id`),</span><br><span class="line"></span><br><span class="line">  KEY `fr2` (`order_id`),</span><br><span class="line"></span><br><span class="line">  CONSTRAINT `fr1` FOREIGN KEY (`good_id`) REFERENCES `t_goods` (`id`),</span><br><span class="line"></span><br><span class="line">  CONSTRAINT `fr2` FOREIGN KEY (`order_id`) REFERENCES `t_orders` (`id`)</span><br><span class="line"></span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">-- Records of t_goods_orders</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods_orders` VALUES (&apos;1&apos;, &apos;1&apos;, &apos;1&apos;, &apos;2&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods_orders` VALUES (&apos;2&apos;, &apos;2&apos;, &apos;1&apos;, &apos;1&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods_orders` VALUES (&apos;3&apos;, &apos;3&apos;, &apos;1&apos;, &apos;1&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods_orders` VALUES (&apos;4&apos;, &apos;3&apos;, &apos;2&apos;, &apos;1&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_goods_orders` VALUES (&apos;5&apos;, &apos;5&apos;, &apos;2&apos;, &apos;3&apos;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">-- Table structure for `t_orders`</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">DROP TABLE IF EXISTS `t_orders`;</span><br><span class="line"></span><br><span class="line">CREATE TABLE `t_orders` (</span><br><span class="line"></span><br><span class="line">  `id` int(11) NOT NULL auto_increment,</span><br><span class="line"></span><br><span class="line">  `customer_id` int(11) NOT NULL default &apos;0&apos;,</span><br><span class="line"></span><br><span class="line">  `totleprice` float default NULL,</span><br><span class="line"></span><br><span class="line">  PRIMARY KEY  (`id`),</span><br><span class="line"></span><br><span class="line">  KEY `ff` (`customer_id`),</span><br><span class="line"></span><br><span class="line">  CONSTRAINT `ff` FOREIGN KEY (`customer_id`) REFERENCES `t_customer` (`id`)</span><br><span class="line"></span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">-- Records of t_orders</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_orders` VALUES (&apos;1&apos;, &apos;1&apos;, &apos;1000&apos;);</span><br><span class="line"></span><br><span class="line">INSERT INTO `t_orders` VALUES (&apos;2&apos;, &apos;1&apos;, &apos;20000&apos;);</span><br><span class="line"></span><br><span class="line">（2）  定义t_orders、t_goods所对应的POJO类</span><br><span class="line"></span><br><span class="line">（3）  定义或修改相应的映射文件，使用MyBatis嵌套结果的方式定义一个根据订单Id查询当前订单所对应的商品信息，并写出DAO,DAO实现类，测试类进行测试。</span><br><span class="line"></span><br><span class="line">（4）  定义或修改相应的映射文件，使用MyBatis嵌套查询的方式定义一个根据订单Id查询当前订单所对应的商品信息，并写出DAO,DAO实现类，测试类进行测试。</span><br><span class="line"></span><br><span class="line">（5）  定义或修改相应的映射文件，增加一条订单信息，该订单中有三个已有的商品，注意订单总价格是程序计算出来的，并写出DAO,DAO实现类，测试类进行测试。</span><br><span class="line"></span><br><span class="line">（6）  定义或修改相应的映射文件，修改（5）的订单信息，将订单中有三个的商品改成两个商品，并写出DAO,DAO实现类，测试类进行测试。</span><br><span class="line"></span><br><span class="line">（7）  定义或修改相应的映射文件，删除一条订单信息，注意该订单中的商品不会级联删除，并写出DAO,DAO实现类，测试类进行测试。</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>第一个要求没什么好说的，连接你的mysql，执行这些语句就行了。<br>从这里我们能够看得出，老师的题目布置的有问题，因为根本没有用到customer_id，还搞了个这个的外键，而且还没有建立外键引用的这个表，明显就是错误，order表根本不会建立成功，所以我们修改sql语句。不要使用老师给的sql语句，别用，用就出错。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`t_goods`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_goods`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment,</span><br><span class="line">  <span class="string">`goodname`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">default</span> <span class="string">''</span>,</span><br><span class="line">  <span class="string">`price`</span> <span class="built_in">float</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">default</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>  (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'nike shoes12-3'</span>, <span class="string">'560'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'李宁15-1'</span>, <span class="string">'146'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'外套'</span>, <span class="string">'780'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods`</span> <span class="keyword">VALUES</span> (<span class="string">'4'</span>, <span class="string">'裤子'</span>, <span class="string">'360'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods`</span> <span class="keyword">VALUES</span> (<span class="string">'5'</span>, <span class="string">'帽子'</span>, <span class="string">'160'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods`</span> <span class="keyword">VALUES</span> (<span class="string">'6'</span>, <span class="string">'手表'</span>, <span class="string">'30000'</span>);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`t_orders`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_orders`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment,</span><br><span class="line">  <span class="string">`totleprice`</span> <span class="built_in">float</span> <span class="keyword">default</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>  (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_orders`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'1000'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_orders`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'20000'</span>);</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`t_goods_orders`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_goods_orders`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment,</span><br><span class="line">  <span class="string">`good_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">default</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`order_id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">default</span> <span class="string">'0'</span>,</span><br><span class="line">  <span class="string">`number`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">default</span> <span class="string">'0'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>  (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fr1`</span> (<span class="string">`good_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fr2`</span> (<span class="string">`order_id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fr1`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`good_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`t_goods`</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`fr2`</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (<span class="string">`order_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`t_orders`</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods_orders`</span> <span class="keyword">VALUES</span> (<span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'2'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods_orders`</span> <span class="keyword">VALUES</span> (<span class="string">'2'</span>, <span class="string">'2'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods_orders`</span> <span class="keyword">VALUES</span> (<span class="string">'3'</span>, <span class="string">'3'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods_orders`</span> <span class="keyword">VALUES</span> (<span class="string">'4'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>, <span class="string">'1'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`t_goods_orders`</span> <span class="keyword">VALUES</span> (<span class="string">'5'</span>, <span class="string">'5'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义t_orders、t_goods所对应的POJO类<br>2.1 新建一个Dynamic Web Project（其实这个地方也并不是一定需要这种，其实java project完全也支持上述的要求，因为我们没有用的spring mvc，但是考虑到框架整合，肯定是需要用到spring mvc的，所以这里选择这个），一路next<br>2.2 在src下面新建一个包用来放po类,我这里创建的包名是<code>top.gamewan.blog.po</code><br>2.3 创建Order类和good类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Order.java</span></span><br><span class="line"><span class="keyword">package</span> top.gamewan.blog.po;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Integer id;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">float</span> totleprice;</span><br><span class="line">List&lt;Good&gt; goods;</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Good&gt; <span class="title">getGoods</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> goods;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGoods</span><span class="params">(List&lt;Good&gt; goods)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.goods = goods;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.id = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getTotleprice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> totleprice;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotleprice</span><span class="params">(<span class="keyword">float</span> totleprice)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.totleprice = totleprice;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">"Order [id="</span> + id + <span class="string">", totleprice="</span> + totleprice + <span class="string">", goods="</span> + goods + <span class="string">"]"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Good.java</span></span><br><span class="line"><span class="keyword">package</span> top.gamewan.blog.po;</span><br><span class="line"><span class="keyword">package</span> top.gamewan.blog.po;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Good</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	<span class="keyword">private</span> String goodname;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">float</span> price;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getGoodname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> goodname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGoodname</span><span class="params">(String goodname)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.goodname = goodname;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> price;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">float</span> price)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.price = price;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"good [id="</span> + id + <span class="string">", goodname="</span> + goodname + <span class="string">", price="</span> + price + <span class="string">"]"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>定义或修改相应的映射文件，使用MyBatis嵌套结果的方式定义一个根据订单Id查询当前订单所对应的商品信息，并写出DAO,DAO实现类，测试类进行测试。<br>3.1 导入相关jar包<br>3.2 在src下面创建<code>log4j.properties</code>，配置日志输出配置,内容：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Global logging configuration</span><br><span class="line">log4j.rootLogger=ERROR, stdout</span><br><span class="line"># MyBatis logging configuration...</span><br><span class="line">log4j.logger.com.itheima=DEBUG</span><br><span class="line"># Console output...</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%5p [%t] - %m%n</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">3.3 在src下面创建`db.properties`配置数据库连接信息，内容为:</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>jdbc.drive=com.mysql.jdbc.Driver<br>jdbc.url=jdbc:mysql://localhost:3306/test<br>jdbc.username=root<br>jdbc.password=root<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">上述内容按照自己的实际情况填写  </span><br><span class="line">3.4 在src下面创建`mybatis-config.xml`，内容为:</span><br><span class="line">``` xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span><br><span class="line">    &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">	&lt;!-- 引入数据库连接配置文件 --&gt;</span><br><span class="line">	&lt;properties resource=&quot;db.properties&quot; /&gt; </span><br><span class="line">	&lt;!-- 使用扫描包的形式定义别名 --&gt;</span><br><span class="line">	&lt;typeAliases&gt;</span><br><span class="line">		&lt;package name=&quot;top.gamewan.blog.po&quot;/&gt;</span><br><span class="line">	&lt;/typeAliases&gt;</span><br><span class="line">    &lt;!--1.配置环境 ，默认的环境id为mysql--&gt;</span><br><span class="line">   &lt;!-- &lt;environments default=&quot;mysql&quot;&gt;</span><br><span class="line">        &lt;environment id=&quot;mysql&quot;&gt;</span><br><span class="line">            &lt;transactionManager type=&quot;JDBC&quot; /&gt;</span><br><span class="line">            &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">			  &lt;property name=&quot;driver&quot; value=&quot;$&#123;jdbc.drive&#125;&quot; /&gt;</span><br><span class="line">			  &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</span><br><span class="line">			  &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt;</span><br><span class="line">			  &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt; --&gt;</span><br><span class="line">    &lt;!--2.配置Mapper的位置 --&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">		&lt;mapper resource=&quot;top/gamewan/blog/mapper/goodsMapper.xml&quot;/&gt;</span><br><span class="line">		&lt;mapper resource=&quot;top/gamewan/blog/mapper/goodsordersMapper.xml&quot;/&gt;</span><br><span class="line">		 &lt;mapper resource=&quot;top/gamewan/blog/mapper/ordersMapper.xml&quot;/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure></p>
<p>3.5 创建一个包名为<code>top.gamewan.blog.mapper</code>的包,在里面新建<code>ordersMapper.xml</code>、<code>goodsMapper.xml</code>,<code>goodsordersMapper.xml</code>，内容为:<br>goodsMapper.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"top.gamewan.blog.GoodsMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findgoodbyorderid"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultType</span>=<span class="string">"Good"</span>&gt;</span></span><br><span class="line">    select g.* from t_goods g,t_goods_orders go where go.order_id=#&#123;id&#125; and go.good_id=g.id </span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findgoodbyid"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultType</span>=<span class="string">"Good"</span>&gt;</span></span><br><span class="line">    select * from t_goods where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>ordersMapper.xml：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"top.gamewan.blog.OrdersMapper"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 嵌套查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findorderbyid"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultMap</span>=<span class="string">"orderresultmapper"</span>&gt;</span></span><br><span class="line">     select o.* from t_orders o where o.id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Order"</span> <span class="attr">id</span>=<span class="string">"orderresultmapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"totleprice"</span> <span class="attr">column</span>=<span class="string">"totleprice"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"goods"</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">ofType</span>=<span class="string">"Good"</span> <span class="attr">select</span>=<span class="string">"top.gamewan.blog.GoodsMapper.findgoodbyorderid"</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 嵌套结果 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findorderbyid1"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">resultMap</span>=<span class="string">"orderresultmapper1"</span>&gt;</span></span><br><span class="line">    select o.*,g.id gid,g.goodname,g.price from t_orders o,t_goods g,t_goods_orders go </span><br><span class="line">    where o.id=#&#123;id&#125; and go.order_id=o.id and g.id=go.good_id; </span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Order"</span> <span class="attr">id</span>=<span class="string">"orderresultmapper1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"totleprice"</span> <span class="attr">column</span>=<span class="string">"totleprice"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"goods"</span> <span class="attr">ofType</span>=<span class="string">"Good"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"gid"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"goodname"</span> <span class="attr">column</span>=<span class="string">"goodname"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"price"</span> <span class="attr">column</span>=<span class="string">"price"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addorder"</span> <span class="attr">parameterType</span>=<span class="string">"order"</span>&gt;</span></span><br><span class="line">    insert into t_orders values(#&#123;id&#125;,#&#123;totleprice&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateorder"</span> <span class="attr">parameterType</span>=<span class="string">"order"</span>&gt;</span></span><br><span class="line">    update t_orders set totleprice=#&#123;totleprice&#125; where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deletebyid"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">    delete from t_orders where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>goodsordersMapper.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"top.gamewan.blog.GoodsOrdersMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addgo"</span> <span class="attr">parameterType</span>=<span class="string">"GoodsOrders"</span>&gt;</span></span><br><span class="line">    insert into t_goods_orders values(null,#&#123;goodid&#125;,#&#123;orderid&#125;,#&#123;number&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deletebyorderid"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">    delete from t_goods_orders where order_id=#&#123;orderid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3.6 在src下面新建<code>applicationContext.xml</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">    xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;</span><br><span class="line">    xmlns:tx=&quot;http://www.springframework.org/schema/tx&quot; </span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans </span><br><span class="line">    http://www.springframework.org/schema/beans/spring-beans-4.3.xsd</span><br><span class="line">    http://www.springframework.org/schema/tx</span><br><span class="line">    http://www.springframework.org/schema/tx/spring-tx-4.3.xsd</span><br><span class="line">    http://www.springframework.org/schema/context</span><br><span class="line">    http://www.springframework.org/schema/context/spring-context-4.3.xsd</span><br><span class="line">    http://www.springframework.org/schema/aop</span><br><span class="line">    http://www.springframework.org/schema/aop/spring-aop-4.3.xsd&quot;&gt;</span><br><span class="line">    &lt;!-- 读取db.Properties --&gt;</span><br><span class="line">    &lt;context:property-placeholder location=&quot;classpath:db.properties&quot;/&gt;</span><br><span class="line">    &lt;!-- 1.配置数据源 --&gt;</span><br><span class="line">    &lt;bean id=&quot;dataSource&quot; </span><br><span class="line">    class=&quot;org.apache.commons.dbcp2.BasicDataSource&quot;&gt;</span><br><span class="line">		&lt;!--数据库驱动 --&gt;</span><br><span class="line">		&lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.drive&#125;&quot; /&gt;</span><br><span class="line">		&lt;!--连接数据库的url --&gt;</span><br><span class="line">		&lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot; /&gt;</span><br><span class="line">		&lt;!--连接数据库的用户名 --&gt;</span><br><span class="line">		&lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot; /&gt;</span><br><span class="line">		&lt;!--连接数据库的密码 --&gt;</span><br><span class="line">		&lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot; /&gt;</span><br><span class="line">     &lt;/bean&gt;</span><br><span class="line">   &lt;!-- 4.事务管理器，依赖于数据源 --&gt;</span><br><span class="line">   &lt;bean id=&quot;transactionManager&quot; class=</span><br><span class="line">   &quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</span><br><span class="line">   &lt;/bean&gt;	</span><br><span class="line">   &lt;!-- 开始事务注解 --&gt;</span><br><span class="line">	&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;/&gt; </span><br><span class="line">	&lt;!-- 配置工厂 --&gt;</span><br><span class="line">	&lt;bean id=&quot;sqlSessionFactory&quot;</span><br><span class="line">		class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;</span><br><span class="line">		&lt;!-- 注入数据源 --&gt;</span><br><span class="line">		&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</span><br><span class="line">		&lt;!-- 指定核心配置文件位置 --&gt;</span><br><span class="line">		&lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot;/&gt;	</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- 实例化Dao --&gt;</span><br><span class="line">	&lt;bean id=&quot;userDao&quot; class=&quot;top.gamewan.blog.dao.Impl.OrderDaoImpl&quot;&gt;</span><br><span class="line">		&lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot;/&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;!-- &lt;bean class=&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot; id=&quot;usermapper&quot;&gt;</span><br><span class="line">		&lt;property name=&quot;mapperInterface&quot; value=&quot;com.itheima.mapper.UserMapper&quot;&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt; --&gt;</span><br><span class="line">&lt;!-- 	&lt;bean  class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;</span><br><span class="line">     	&lt;property name=&quot;basePackage&quot; value=&quot;com.itheima.mapper&quot; /&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	 --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p>
<p>3.7 在src下新建<code>top.gamewan.blog.dao</code>,新建<code>OrderDao</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package top.gamewan.blog.dao;</span><br><span class="line">import java.util.List;</span><br><span class="line">import top.gamewan.blog.po.GoodsOrders;</span><br><span class="line">import top.gamewan.blog.po.Order;</span><br><span class="line">public interface OrderDao &#123;</span><br><span class="line"> Order getOrderById(Integer id);</span><br><span class="line"> Order getOrderById1(Integer id);</span><br><span class="line"> boolean addOrder(List&lt;GoodsOrders&gt; goodsOrders,Integer orderid) throws Exception;</span><br><span class="line"> boolean updateOrder(Integer orderid,List&lt;GoodsOrders&gt; goodsOrders) throws Exception;</span><br><span class="line"> boolean deleteOrder(Integer orderid) throws Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.8 在src下新建<code>top.gamewan.blog.dao.Impl</code>,新建<code>OrderDaoImpl</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.gamewan.blog.dao.Impl;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.SqlSessionFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.support.SqlSessionDaoSupport;</span><br><span class="line"><span class="keyword">import</span> top.gamewan.blog.dao.OrderDao;</span><br><span class="line"><span class="keyword">import</span> top.gamewan.blog.po.Order;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDaoImpl</span> <span class="keyword">extends</span> <span class="title">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title">OrderDao</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Order <span class="title">getOrderById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> 	<span class="keyword">this</span>.getSqlSession().selectOne(<span class="string">"top.gamewan.blog.OrdersMapper.findorderbyid"</span>,id);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.9 在src下新建<code>top.gamewan.blog.test</code> 新建一个junit测试类:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> top.gamewan.blog.dao.Impl;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.support.SqlSessionDaoSupport;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Isolation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> top.gamewan.blog.dao.OrderDao;</span><br><span class="line"><span class="keyword">import</span> top.gamewan.blog.po.Good;</span><br><span class="line"><span class="keyword">import</span> top.gamewan.blog.po.GoodsOrders;</span><br><span class="line"><span class="keyword">import</span> top.gamewan.blog.po.Order;</span><br><span class="line"><span class="comment">//开启事务管理</span></span><br><span class="line"><span class="meta">@Transactional</span>(propagation=Propagation.REQUIRED,isolation=Isolation.DEFAULT,readOnly=<span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderDaoImpl</span> <span class="keyword">extends</span> <span class="title">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title">OrderDao</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Order <span class="title">getOrderById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> </span><br><span class="line">		<span class="keyword">this</span>.getSqlSession().selectOne(<span class="string">"top.gamewan.blog.OrdersMapper.findorderbyid"</span>,id);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Order <span class="title">getOrderById1</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.getSqlSession().selectOne(<span class="string">"top.gamewan.blog.OrdersMapper.findorderbyid1"</span>, id);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addOrder</span><span class="params">(List&lt;GoodsOrders&gt; goodsOrders,Integer orderid )</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">float</span> result=<span class="number">0</span>;</span><br><span class="line">		SqlSession session=<span class="keyword">this</span>.getSqlSession();</span><br><span class="line">		<span class="keyword">for</span>(GoodsOrders go:goodsOrders) &#123;</span><br><span class="line">			Integer gid=go.getGoodid();</span><br><span class="line">			Good good=</span><br><span class="line">			session.selectOne(<span class="string">"top.gamewan.blog.GoodsMapper.findgoodbyid"</span>,gid);</span><br><span class="line">			result+=good.getPrice()*go.getNumber();</span><br><span class="line">		&#125;</span><br><span class="line">		Order order=<span class="keyword">new</span> Order();</span><br><span class="line">		order.setTotleprice(result);</span><br><span class="line">		order.setId(orderid);</span><br><span class="line">		<span class="keyword">if</span>(session.update(<span class="string">"top.gamewan.blog.OrdersMapper.addorder"</span>,order)!=<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="comment">//throw exception可以让自动事务处理处理这个事件</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//插入t_goods_orders</span></span><br><span class="line">		<span class="keyword">for</span>(GoodsOrders go:goodsOrders) &#123;</span><br><span class="line">			<span class="comment">//自动事务处理</span></span><br><span class="line">			<span class="keyword">if</span>(session.update(<span class="string">"top.gamewan.blog.GoodsOrdersMapper.addgo"</span>, go)!=<span class="number">1</span>) &#123;	</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">			&#125;	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">updateOrder</span><span class="params">(Integer orderid, List&lt;GoodsOrders&gt; goodsOrders)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">float</span> result=<span class="number">0</span>;</span><br><span class="line">		SqlSession session=<span class="keyword">this</span>.getSqlSession();</span><br><span class="line">		<span class="keyword">for</span>(GoodsOrders go:goodsOrders) &#123;</span><br><span class="line">			Integer gid=go.getGoodid();</span><br><span class="line">			Good good=</span><br><span class="line">			session.selectOne(<span class="string">"top.gamewan.blog.GoodsMapper.findgoodbyid"</span>,gid);</span><br><span class="line">			result+=good.getPrice()*go.getNumber();</span><br><span class="line">		&#125;</span><br><span class="line">		Order order=<span class="keyword">new</span> Order();</span><br><span class="line">		order.setTotleprice(result);</span><br><span class="line">		order.setId(orderid);</span><br><span class="line">		<span class="keyword">if</span>(session.update(<span class="string">"top.gamewan.blog.OrdersMapper.updateorder"</span>,order)!=<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="comment">//throw exception可以让自动事务处理处理这个事件</span></span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//删掉原订单中的商品</span></span><br><span class="line">		<span class="keyword">if</span>(session.delete(<span class="string">"top.gamewan.blog.GoodsOrdersMapper.deletebyorderid"</span>, orderid)==-<span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//添加新的商品</span></span><br><span class="line">		<span class="keyword">for</span>(GoodsOrders go:goodsOrders) &#123;</span><br><span class="line">			<span class="comment">//自动事务处理</span></span><br><span class="line">			<span class="keyword">if</span>(session.update(<span class="string">"top.gamewan.blog.GoodsOrdersMapper.addgo"</span>, go)!=<span class="number">1</span>) &#123;	</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">			&#125;	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteOrder</span><span class="params">(Integer orderid)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="comment">//先删除t_goods_orders表中的数据</span></span><br><span class="line">		SqlSession session=<span class="keyword">this</span>.getSqlSession();</span><br><span class="line">		<span class="keyword">if</span>(session.delete(<span class="string">"top.gamewan.blog.GoodsOrdersMapper.deletebyorderid"</span>, orderid)!=<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//再删除t_orders表中的数据</span></span><br><span class="line">		<span class="keyword">if</span>(session.delete(<span class="string">"top.gamewan.blog.OrdersMapper.deletebyid"</span>,orderid)==-<span class="number">1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.10 运行查看结果<br><img src="/xuxin.github.io/images/pasted-7.png" alt="upload successful"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li>因为有太多的联系，代码很难根据每个小问分开，因为后面很多的要求都是写在同一个文件里的，所以不再分开了，本文已经尽量完善的了题目中的所有要求。可以说是符合题目要求了。但是在我看来并不是那么完美，因为当你去插入一条订单的时候是不应该指定订单号的，而是利用自增属性获得，但是当插入到t_order表里之后，如何获取这个订单的id成为一个难点，当然简单的获取也是不难的，但是考虑到多线程，高并发的情况下，我们不能单独取出当前表最大的id，因为那样不可靠，看了网上的解决方案感觉也并不能让我满意，所以还是指定了orderid。</li>
<li>这种多对多的情况下，删除修改并不是那么简简单单的，起码不是一句sql语句就能解决的问题。要注意逻辑，先干什么，后干什么，加入事务处理之后要在事务处理失败时及时throw exception，让spring回滚事务，这里注意的一点是，Exception并不会触发事务回滚，只有以RuntimeException及其子类才会触发它的回滚。所以这里要特别注意。</li>
<li>限于作业要求，其实其中有不符合我们开发逻辑的东西，但是我没有改正。比如，Dao层应该是跟数据库交互的层，不应该设计过多的业务逻辑，就是增删改查，而且是最简单的那种，一个Dao类的方法里面不应该运行多条sql语句，并且@Transactional应该加在services层等等</li>
<li>还有，题目中的sql语句有问题，要了解其中的原由，改掉其中的问题。</li>
</ul>

            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2019年07月30日 18:37</p>
        <p>原始链接： <a class="post-url" href="/xuxin.github.io/2019/05/08/Mybatis与spring的结合使用/" title="Mybatis与spring的结合使用">https://github.com/xuxin3101/xuxin.github.io/2019/05/08/Mybatis与spring的结合使用/</a></p>
        <footer>
            <a href="https://github.com/xuxin3101/xuxin.github.io">
                <img src="/xuxin.github.io/images/logo.png" alt="宋熙卿e">
                宋熙卿e
            </a>
        </footer>
    </div>
</div>

      
        
            
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;">赏</a>
</div>

<div id="reward" class="post-modal reward-lay">
    <a class="close" href="javascript:;" id="reward-close">×</a>
    <span class="reward-title">
        <i class="icon icon-quote-left"></i>
        请我吃糖~
        <i class="icon icon-quote-right"></i>
    </span>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/xuxin.github.io/images/wechat_code.jpg" alt="打赏二维码">
        </div>
        <div class="reward-select">
            
            <label class="reward-select-item checked" data-id="wechat" data-wechat="/xuxin.github.io/images/wechat_code.jpg">
                <img class="reward-select-item-wechat" src="/xuxin.github.io/images/wechat.png" alt="微信">
            </label>
            
            
            <label class="reward-select-item" data-id="alipay" data-alipay="/xuxin.github.io/images/alipay_code.jpg">
                <img class="reward-select-item-alipay" src="/xuxin.github.io/images/alipay.png" alt="支付宝">
            </label>
            
        </div>
    </div>
</div>


        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://github.com/xuxin3101/xuxin.github.io/2019/05/08/Mybatis与spring的结合使用/&title=《Mybatis与spring的结合使用》 — 我的博客&pic=https://github.com/xuxin3101/xuxin.github.ioimages/logo.png" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://github.com/xuxin3101/xuxin.github.io/2019/05/08/Mybatis与spring的结合使用/&title=《Mybatis与spring的结合使用》 — 我的博客&source=" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://github.com/xuxin3101/xuxin.github.io/2019/05/08/Mybatis与spring的结合使用/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Mybatis与spring的结合使用》 — 我的博客&url=https://github.com/xuxin3101/xuxin.github.io/2019/05/08/Mybatis与spring的结合使用/&via=https://github.com/xuxin3101/xuxin.github.io" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://github.com/xuxin3101/xuxin.github.io/2019/05/08/Mybatis与spring的结合使用/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=https://github.com/xuxin3101/xuxin.github.io/2019/05/08/Mybatis与spring的结合使用/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/xuxin.github.io/tags/orm/" class="color4">orm</a>
      
    <a href="/xuxin.github.io/tags/spring/" class="color2">spring</a>
      
    <a href="/xuxin.github.io/tags/mybatis/" class="color3">mybatis</a>
      
    <a href="/xuxin.github.io/tags/事务/" class="color3">事务</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#总结"><span class="post-toc-text">总结</span></a></li></ol>
        </nav>
    </aside>
    

<nav id="article-nav">
  
    <a href="/xuxin.github.io/2019/06/05/oracle中pl-sql的使用/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          oracle中pl/sql的使用和触发器的简单使用
        
      </span>
    </a>
  
  
    <a href="/xuxin.github.io/2019/04/27/spring-mvc实践/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">spring mvc实践</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2019 宋熙卿e<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "https://github.com/xuxin3101/xuxin.github.io",
      animate: true,
      isHome: false,
      share: true,
      reward: 1
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/xuxin.github.io/tags/mvc/" style="font-size: 10px;">mvc</a> <a href="/xuxin.github.io/tags/mybatis/" style="font-size: 20px;">mybatis</a> <a href="/xuxin.github.io/tags/orm/" style="font-size: 10px;">orm</a> <a href="/xuxin.github.io/tags/spring/" style="font-size: 15px;">spring</a> <a href="/xuxin.github.io/tags/事务/" style="font-size: 10px;">事务</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a href="/xuxin.github.io/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a href="/xuxin.github.io/archives">
                    <i class="fa fa-archive"></i><span>归档</span>
                </a>
            </li>
            
            <li>
                <a href="/xuxin.github.io/about">
                    <i class="fa fa-user"></i><span>关于</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/xuxin.github.io/tags/mvc/" style="font-size: 10px;">mvc</a> <a href="/xuxin.github.io/tags/mybatis/" style="font-size: 20px;">mybatis</a> <a href="/xuxin.github.io/tags/orm/" style="font-size: 10px;">orm</a> <a href="/xuxin.github.io/tags/spring/" style="font-size: 15px;">spring</a> <a href="/xuxin.github.io/tags/事务/" style="font-size: 10px;">事务</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="/xuxin.github.io/js/search.js"></script>
<script src="/xuxin.github.io/js/main.js"></script>


  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  <script src="/xuxin.github.io/js/particles.js"></script>







  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  <script src="/xuxin.github.io/js/animate.js"></script>


  <script src="/xuxin.github.io/js/pop-img.js"></script>
  <script>
     $(".article-entry p img").popImg();
  </script>

  </div>
</body>
</html>